# **Операционный Протокол "ХРОНИСТ" v4.0**
**Статус:** Активен
**Для агента:** ERA-LORE-SMITH
**Миссия:** Автономная систематизация и нарративное расширение хронологии мира «Эпоха Порядка» (`lore/timeline_lore/overall_timeline.md`).

---

## **0. Структура Репозитория**
/lore/
├── historical_narratives/   # Итоговые утвержденные истории
│   └── {Эра}/{Подэра}/{slug}/
│       ├── final/
│       │   ├── {slug}__vX.Y.Z.md
│       │   └── council_summary.md
│       └── _work_completed/  # Завершенная рабочая папка
│           ├── 00_brief.md
│           ├── 05_overall_plan.md        # <-- НОВЫЙ ФАЙЛ
│           ├── 10_hooks_candidates.md    # Хуки для плана
│           ├── 20_council_hooks_review.md # Ревью хуков для плана
│           ├── 30_synthesis_proposition.md # Общий синтез
│           └── part01/
│               ├── 10_hooks_candidates.md # Хуки для части 1
│               ├── 20_council_hooks_review.md # Ревью хуков части 1
│               ├── 30_synthesis_proposition.md # Синтез для части 1
│               └── round01/
│                   ├── 20_narrative_draft.md
│                   ├── 30_council_final_review.md
│                   └── 40_writer_aggregate_report.md
│           └── part02/
│               └── ...
└── timeline_lore/
│   ├── 01_TIMELINE_TASKS.md   # Глобальный план работ
│   └── overall_timeline.md      # Исходный таймлайн
└── GLOBAL_REGISTRY.md
templates/               # Шаблоны для работы
├── 01_TIMELINE_TASKS.md
├── 02_TASK_BRIEF.md
├── 03_HOOKS_CANDIDATES.md
├── 04_COUNCIL_HOOKS_REVIEW.md
├── 05_SYNTHESIS_PROPOSITION.md
├── 06_FINAL_COUNCIL_REVIEW.md
├── 07_WRITER_AGGREGATE_REPORT.md
└── COUNCIL_ROLES.md       # Описание ролей Совета
### **0.1. Нотация «частей»**
- Для любой задачи можно задать **Parts=1..4**.
- Рабочие файлы для каждой части располагаются внутри `_work/partPP/`.
- Файлы итераций написания (раунды) располагаются внутри `_work/partPP/roundNN/`.
- Все финальные тексты **сливаются в один файл** в `final/{slug}__vX.Y.Z.md` с отчётливыми разделителями `### [PART 01]`, `### [PART 02]` и т.д.

---

## **1. Фаза I: Планирование**

1.  **Создание Плана Задач:** Если `lore/timeline_lore/01_TIMELINE_TASKS.md` отсутствует — **создать файл по шаблону** `templates/01_TIMELINE_TASKS.md`, **сразу заполнив** таблицу на основе `overall_timeline.md`:
    -   Колонки: `№ | Якорь таймлайна (ссылка/ID) | Краткое событие | Эра | Подэра | Событие | Путь | Slug | Приоритет (H/M/L) | Статус | Parts (1–4) | Текущий Раунд | Текущая Часть| Примечания`
    -   Изначальные значения: `Статус = Не выполнено`, `Parts = 1`.
2.  **Инициализация Реестра:** Создать файл `lore/GLOBAL_REGISTRY.md`, если он не существует.

---

## **2. Фаза II: Цикл Нарративной Генерации (для каждой задачи)**

### **Шаг 0: Инициация Задачи**
1.  Изменить статус задачи в `01_TIMELINE_TASKS.md` на **В работе**.
2.  Создать рабочую директорию: `/lore/historical_narratives/{Эра}/{Подэра}/{slug}/_work/`.
3.  Скопировать `templates/02_TASK_BRIEF.md` в `_work/00_brief.md` и тщательно его заполнить, сверившись с `GLOBAL_REGISTRY.md`.

### **Шаг A: Стратегическое Планирование (для многочастных задач)**
*Этот шаг выполняется, только если в `01_TIMELINE_TASKS.md` для задачи указано `Parts > 1`.*

1.  **Общий План:** Создать и заполнить файл `_work/05_overall_plan.md`, описав в нем общую сюжетную арку, которая будет разделена на все части. Определить, чем каждая часть будет начинаться и заканчиваться.
2.  **Генерация Хуков для Плана:** В `_work/10_hooks_candidates.md` сгенерировать 3-6 хуков (по 1-2 на часть), отражающих **общую идею всей истории**.
3.  **Ревью Хуков и Утверждение Плана:**
    -   В `_work/20_council_hooks_review.md` провести симуляцию ревью хуков **общего плана**.
    -   Выбрать лучшие хуки и на их основе финализировать общую концепцию. **Совет должен дать одобрение на общую идею, прежде чем начнется работа над частями.**
4.  **Синтез-Пропозиция (Глобальная):** На основе одобренных хуков заполнить `_work/30_synthesis_proposition.md`, который будет служить ориентиром для **всей истории**.

### **Шаг B: Последовательная Разработка Частей (Цикл для каждой части от 1 до N)**

*Для каждой части (Part 1, Part 2, ...) выполняются следующие шаги:*

1.  **Инициация Части:**
    -   Обновить поле `Текущая Часть` в `01_TIMELINE_TASKS.md`.
    -   Создать директорию `_work/partXX/`.

2.  **Генерация и Ревью Хуков для Части:**
    -   В `_work/partXX/10_hooks_candidates.md` сгенерировать 1-3 хуков, которые конкретизируют события, конфликты  **именно этой части**, с учётом общего плана и предыдущих частей.
    -   В `_work/partXX/20_council_hooks_review.md` провести симуляцию ревью хуков **текущей части**.
    -   Выбрать лучшие и создать `_work/partXX/30_synthesis_proposition.md` для данной части.

3.  **Итерации Написания (Начало Раунда 1 для Части):**
    -   Создать директорию `_work/partXX/round01/`.
    -   Написать полный черновик **текущей части** истории в файле `_work/partXX/round01/20_narrative_draft.md`, строго следуя Синтез-Пропозиции части и общему плану.

4.  **Финальное Ревью (Раунд 1 для Части):**
    -   Провести симуляцию полного ревью черновика в `_work/partXX/round01/30_council_final_review.md`.

5.  **Решение и Доработка по Части:**
    -   Заполнить агрегированный отчет в `_work/partXX/round01/40_writer_aggregate_report.md`.
    -   Проверить прохождение порогов:
        -   Ни один эксперт < **4**.
        -   Самооценка LORE-WRITER ≥ **8**.
        -   Средняя оценка > **8.5**.
        -   CANON-AUDITOR и WORLD-ARCHITECT ≥ **8**.
    -   Принять решение по части:
        -   **APPROVED:** Переход к следующей части (возврат к п.1 этого шага) или, если это последняя часть, переход к **Шагу C: Финализация**.
        -   **minor/major rewrite:** Сформулировать правки. **Начать новый раунд для этой же части** (создать `round02/`, написать новую версию и т.д.).

### **Шаг C: Финализация (после утверждения всех частей)**

1.  **Сборка Итогового Файла:**
    -   Создать директорию `final/` внутри `{slug}/`.
    -   Собрать **единый** текстовый файл `final/{slug}__v1.0.0.md` из последних утвержденных версий черновиков всех частей (например, из `part01/round02/20_narrative_draft.md`, `part02/round01/20_narrative_draft.md` и т.д.), разделяя их заголовками `### [PART 01]`, `### [PART 02]` и т.д.
2.  **Итоговый Отчет:** Создать `final/council_summary.md`, указав итоговые средние баллы по **каждой части** и финальный вердикт.
3.  **Обновление Глобального Реестра:** Открыть `lore/GLOBAL_REGISTRY.md` и внести все новые сущности, места и последствия событий из утвержденной истории.
4.  **Архивация Работы:** Переименовать директорию `_work` в `_work_completed`.
5.  **Завершение Задачи:** Изменить статус задачи в `01_TIMELINE_TASKS.md` на **Готово**.