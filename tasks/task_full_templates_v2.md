# **Операционный Протокол "ХРОНИСТ" v5.1**
**Статус:** Активен
**Для агента:** ERA-LORE-SMITH
**Миссия:** Автономная систематизация и нарративное расширение хронологии мира «Эпоха Порядка» (`lore/timeline_lore/overall_timeline.md`).

---

## **0. Ключевые Концепции и Структура**

### **0.1. Структура Репозитория**
/lore/
├── historical_narratives/   # Итоговые утвержденные истории
│   └── {Эра}/{Подэра}/{slug}/
│       ├── final/
│       │   ├── {slug}__vX.Y.Z.md
│       │   └── council_summary.md
│       └── _work_completed/  # Завершенная рабочая папка
│           ├── 00_brief.md
│           ├── 05_overall_plan.md
│           ├── 10_hooks_candidates.md
│           ├── 20_council_hooks_review.md
│           ├── 30_synthesis_proposition.md
│           └── part01/
│               ├── ...
│           └── part02/
│               └── ...
└── timeline_lore/
│   ├── 01_TIMELINE_TASKS.md   # Глобальный план работ
│   └── overall_timeline.md
└── GLOBAL_REGISTRY.md
templates/               # Шаблоны для работы
├── 01_TIMELINE_TASKS.md
├── 02_TASK_BRIEF.md
├── 03_HOOKS_CANDIDATES.md
├── 04_COUNCIL_HOOKS_REVIEW.md
├── 05_SYNTHESIS_PROPOSITION.md
├── 06_FINAL_COUNCIL_REVIEW.md
├── 07_WRITER_AGGREGATE_REPORT.md
└── COUNCIL_ROLES.md
### **0.2. Нотация «частей»**
- Для любой задачи можно задать **Parts=1..4**.
- Рабочие файлы для каждой части располагаются внутри `_work/partXX/`.
- Файлы итераций написания располагаются внутри `_work/partXX/roundNN/`.
- Все финальные тексты сливаются в один файл в `final/{slug}__vX.Y.Z.md` с разделителями `### [PART 01]`, `### [PART 02]` и т.д.

---
## **1. Фаза I: Планирование (пакетный режим)**

Процесс создания `lore/timeline_lore/01_TIMELINE_TASKS.md` выполняется итеративно.

1.  **Формирование Группы (Чанка):** Взять следующую логическую группу, состоящую из **3–10** нераспланированных событий из `overall_timeline.md`.
2.  **Анализ и Определение Объёма:** Для каждой задачи внутри текущей группы проанализировать её масштаб и нарративный потенциал. Определить необходимое количество частей от 1 до 4 частей, в зависимости от масштаба и подготовить данные для колонок.
3.  **Заполнение Таблицы Задач:** Добавить проанализированную группу задач в таблицу `01_TIMELINE_TASKS.md`. Если файл не существует, он создается по шаблону. Для всех новых задач `Статус` устанавливается как `Не выполнено`.
4.  **Повторение:** Повторять шаги 1–3 до тех пор, пока все события из `overall_timeline.md` не будут перенесены и проанализированы в `01_TIMELINE_TASKS.md`.
5.  **Инициализация Реестра:** Создать файл `lore/GLOBAL_REGISTRY.md`, если он не существует.

---
## **2. Фаза II: Цикл Нарративной Генерации**

### **Шаг 0: Инициация Задачи**
1.  Изменить статус задачи в `01_TIMELINE_TASKS.md` на **`В работе`**.
2.  Создать рабочую директорию: `/lore/historical_narratives/{Эра}/{Подэра}/{slug}/_work/`.
3.  Скопировать `templates/02_TASK_BRIEF.md` в `_work/00_brief.md`.
4.  Тщательно **заполнить** `_work/00_brief.md`, сверившись с `GLOBAL_REGISTRY.md`.

### **Шаг A: Стратегическое Планирование (только если `Parts > 1`)**
1.  **Создание Общего Плана:** Создать и **заполнить** файл `_work/05_overall_plan.md`, описав в нем общую арку на все части.
2.  **Генерация Хуков для Плана:** Скопировать `templates/03_HOOKS_CANDIDATES.md` в `_work/10_hooks_candidates.md` и **сгенерировать** 1-3 хуков  для общей идеи.
3.  **Ревью Хуков и Синтез для Плана:**
    -   Скопировать `templates/04_COUNCIL_HOOKS_REVIEW.md` в `_work/20_council_hooks_review.md`.
    -   Провести **симуляцию полного ревью хуков**.
        > **Пояснение: "Симуляция ревью"**
        > Это означает, что агент ERA-LORE-SMITH должен сгенерировать экспертную оценку, последовательно выступая от лица каждой из 10 ролей, описанных в `COUNCIL_ROLES.md`. Для этого необходимо:
        > 1.  Открыть шаблон ревью (`04_COUNCIL_HOOKS_REVIEW.md` или `06_FINAL_COUNCIL_REVIEW.md`).
        > 2.  Для каждой роли из `COUNCIL_ROLES.md` (начиная с `CANON-AUDITOR`) проанализировать текст через призму этой роли.
        > 3.  Выставить оценку (0-10) и написать конкретное обоснование в соответствующие поля шаблона.
    -   Скопировать `templates/05_SYNTHESIS_PROPOSITION.md` в `_work/30_synthesis_proposition.md`.
    -   **Создать** сильную **Синтез-Пропозицию** для всей истории.

### **Шаг B: Последовательная Разработка Частей (Цикл для `Part 1...N`)**
*Следующие шаги повторяются для каждой части.*

1.  **Инициация Части:**
    -   Обновить поле `Текущая Часть` в `01_TIMELINE_TASKS.md`.
    -   Создать директорию `_work/partXX/`.
2.  **Генерация и Ревью Хуков для Части:**
    -   Скопировать `templates/03_HOOKS_CANDIDATES.md` в `_work/partXX/10_hooks_candidates.md` и **сгенерировать** 1-3 хуков для этой части.
    -   Скопировать `templates/04_COUNCIL_HOOKS_REVIEW.md` в `_work/partXX/20_council_hooks_review.md` и провести **симуляцию ревью**.
    -   Скопировать `templates/05_SYNTHESIS_PROPOSITION.md` в `_work/partXX/30_synthesis_proposition.md` и **создать** Синтез-Пропозицию для текущей части.
3.  **Написание Черновика (Начало Раунда 1):**
    -   Создать директорию `_work/partXX/round01/`.
    -   **Написать** полный черновик истории в `_work/partXX/round01/20_narrative_draft.md`.
4.  **Финальное Ревью (Раунд 1):**
    -   Скопировать `templates/06_FINAL_COUNCIL_REVIEW.md` в `_work/partXX/round01/30_council_final_review.md`.
    -   Провести **симуляцию развернутого ревью** черновика.
5.  **Решение и Доработка:**
    -   Скопировать `templates/07_WRITER_AGGREGATE_REPORT.md` в `_work/partXX/round01/40_writer_aggregate_report.md`.
    Заполнить отчет, рассчитать средние баллы и проверить прохождение порогов:
    - Ни один эксперт < **4**.
    - Самооценка LORE-WRITER ≥ **8**.
    - Средняя оценка > **8.5**.
    - CANON-AUDITOR и WORLD-ARCHITECT ≥ **8**.
    -   **Вердикт:**
        -   **APPROVED:** Если это последняя часть, перейти к **Шагу C**. Иначе — вернуться к п.1 для следующей части.
        -   **minor/major rewrite:** Сформулировать правки в отчете. Начать новый раунд (`round02`), вернувшись к п.3.

### **Шаг C: Финализация (после утверждения всех частей)**
1.  Создать директорию `final/` внутри `{slug}/`.
2.  **Собрать** единый файл `final/{slug}__v1.0.0.md` из последних утвержденных версий черновиков.
3.  **Создать** `final/council_summary.md`, указав итоговые баллы и вердикт.
4.  **Обновить** `lore/GLOBAL_REGISTRY.md`, внеся все новые сущности и последствия.
    > **Пояснение: Формат обновления `lore/GLOBAL_REGISTRY.md`**
    > Используйте формат Markdown-таблиц для добавления новых записей о персонажах, локациях и событиях, чтобы поддерживать базу данных в актуальном и структурированном виде.
5.  **Архивировать** рабочую директорию.
    > **Пояснение: Архивирование**
    > Это простое переименование папки на месте для сохранения рабочих материалов.
    > - **Команда:** `mv _work _work_completed`
    > - **Расположение:** `/lore/historical_narratives/{Эра}/{Подэра}/{slug}/`
6.  Изменить статус задачи в `01_TIMELINE_TASKS.md` на **`Готово`**.




